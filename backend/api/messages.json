{"messages": [{"creator_id": "U066Q9JAU3B", "text": "We need to carefully trade-off these optimizations with SlackIntegration feature though.. I am engaging with a contractor to build AI knowledge graph on top of slack messages. We will have to prioritize slack integration."}, {"creator_id": "U066Q9JAU3B", "text": "Also, I see some lag in loading the Newsfeed. I will check at the backend if we can improve the database fetch. Otherwise we can introduce some pagination as well so user sees some threads quickly while the others load."}, {"creator_id": "U06M70HTC7Q", "text": "Agreed, I'll add that loader there too."}, {"creator_id": "U066Q9JAU3B", "text": "There is one small enhancement. When the user logs in with Google, sometimes it takes a while. The user still sees 'login with google' button. May be we can show a 'signing in' message with rotating/loading kind of circle?"}, {"creator_id": "U066Q9JAU3B", "text": "sure."}, {"creator_id": "U06M70HTC7Q", "text": "Currently, when a user clicks on the \"Reply in thread\" button, the API creates a child thread and redirects the user to reply within that thread. However, upon returning to the previous page, the same button remains as \"Reply in thread\" within the block. Ideally, this button should be changed to \"Replies\" after creating a child thread."}, {"creator_id": "U066Q9JAU3B", "text": "No worries. I'll wait. I am currently in a meeting where I have to show a small demo. I'll use the develop branch for the demo. Do the PR when you think it's best"}, {"creator_id": "U06M70HTC7Q", "text": "Ok, Let me push today's code to develop. so that you can have latest code."}, {"creator_id": "U06M70HTC7Q", "text": "The issue we were experiencing yesterday has been resolved. However, there are still some finishing things remaining, such as adding child_id within the parent block once the reply thread is created. If you believe this can be addressed after merging the PR to dev, let me know I'll raise the PR."}, {"creator_id": "U066Q9JAU3B", "text": "ok to merge develop branch now?"}, {"creator_id": "U066Q9JAU3B", "text": "Google Firebase documentation is bad! for the life of me, I cannot figure out what I have t do in the back end for open id auth. Let's stick to supertokens. It's already working for Google login. Open ID should be very similar."}, {"creator_id": "U066Q9JAU3B", "text": "renamed all the \"id\" fields in all blocks to \"_id\" in the database. Not sure if this will create any side effects, but we should be good for now. You should be able to create a child to any block now."}, {"creator_id": "U06M70HTC7Q", "text": "Ok, thanks"}, {"creator_id": "U066Q9JAU3B", "text": "Scheduled wire transfer for the 2nd and 3rd installment together ($965 total).  You should see in a day"}, {"creator_id": "U06M70HTC7Q", "text": "```flutter: data:\nflutter: {\"parentBlockId\":\"9a817cdb-fb3f-4ba5-9823-4f219d7b1346\",\"parentThreadId\":\"9ce19006-33dc-414c-b867-8bbcc9180cb9\",\"title\":\"Replynews9a817cdb\",\"type\":\"/new-thread\"}\nflutter: \nflutter: *** Response ***\nflutter: uri: <http://35.209.147.65:8000/blocks/child>\nflutter: Response Text:\nflutter: {\"_id\":\"4c6188a1-a07c-40ca-8966-e34a0fc2d282\",\"creator\":\"Sonu Sharma\",\"created_date\":\"2024-03-20T13:26:17.286634\",\"type\":\"/new-thread\",\"title\":\"Replynews9a817cdb\",\"content\":[{\"_id\":\"9a817cdb-fb3f-4ba5-9823-4f219d7b1346\",\"content\":\"Checking if creating this new block will change \\\"Id\\\" to \\\"_id\\\" or not.\",\"created_at\":\"2024-03-20T06:19:13.496987\",\"created_by\":\"Sonu Sharma\",\"creator_email\":\"<https://lh3.googleusercontent.com/a/ACg8ocKHPIrrxY0nLtFOOHM8j2LnbYDqUw8Fffswny9oNWpcADA=s96-c>\",\"creator_picture\":\"unknown picture link\",\"creator_id\":\"471c9bf1-7da8-4678-b6ee-eca13fb6fa5a\",\"child_id\":\"\"}]}```"}, {"creator_id": "U06M70HTC7Q", "text": "```{\"_id\":\"265a812e-1920-4542-8416-a4e9b1c76d35\",\"creator\":\"Sonu Sharma\",\"created_date\":\"2024-03-20T13:19:29.524622\",\"type\":\"/new-thread\",\"title\":\"Replynews6ebe84be\",\"content\":[{\"_id\":\"6ebe84be-c183-4b19-8d2e-4960a9676c64\",\"content\":\"Getting response as expected. Now it is not an issue anymore atleast for new blocks.\",\"created_at\":\"2024-03-20T06:47:57.005166\",\"created_by\":\"Sonu Sharma\",\"creator_email\":\"<https://lh3.googleusercontent.com/a/ACg8ocKHPIrrxY0nLtFOOHM8j2LnbYDqUw8Fffswny9oNWpcADA=s96-c>\",\"creator_picture\":\"unknown picture link\",\"creator_id\":\"471c9bf1-7da8-4678-b6ee-eca13fb6fa5a\",\"child_id\":\"\"}]}```"}, {"creator_id": "U06M70HTC7Q", "text": "```{\"parentBlockId\":\"6ebe84be-c183-4b19-8d2e-4960a9676c64\",\"parentThreadId\":\"9ce19006-33dc-414c-b867-8bbcc9180cb9\",\"title\":\"Replynews6ebe84be\",\"type\":\"/new-thread\"}```"}, {"creator_id": "U06M70HTC7Q", "text": "Request to ^ response.\n```{\"title\":\"news\",\"type\":\"/new-thread\"}```"}, {"creator_id": "U06M70HTC7Q", "text": "Create child thread response:\n```{\"_id\":\"2ea37d81-3a4b-49b6-8d1c-882be4512768\",\"creator\":\"Sonu Sharma\",\"created_date\":\"2024-03-20T13:17:23.175675\",\"type\":\"/new-thread\",\"title\":\"Replynews9a817cdb\",\"content\":[{\"_id\":\"9a817cdb-fb3f-4ba5-9823-4f219d7b1346\",\"content\":\"Checking if creating this new block will change \\\"Id\\\" to \\\"_id\\\" or not.\",\"created_at\":\"2024-03-20T06:19:13.496987\",\"created_by\":\"Sonu Sharma\",\"creator_email\":\"<https://lh3.googleusercontent.com/a/ACg8ocKHPIrrxY0nLtFOOHM8j2LnbYDqUw8Fffswny9oNWpcADA=s96-c>\",\"creator_picture\":\"unknown picture link\",\"creator_id\":\"471c9bf1-7da8-4678-b6ee-eca13fb6fa5a\",\"child_id\":\"\"}]}```"}, {"creator_id": "U06M70HTC7Q", "text": "``` {\"detail\":[{\"type\":\"string_pattern_mismatch\",\"loc\":[\"body\",\"title\"],\"msg\":\"String should match pattern '^[a-zA-Z0-9]+$'\",\"input\":\"Replymyplan1ea6c601-7\",\"ctx\":{\"pattern\":\"^[a-zA-Z0-9]+$\"},\"url\":\"<https://errors.pydantic.dev/2.6/v/string_pattern_mismatch>\"}]}```"}, {"creator_id": "U06M70HTC7Q", "text": "``` {\"parentBlockId\":\"1ea6c601-7621-4716-92d2-4bd4f4b1d49a\",\"parentThreadId\":\"b110eabb-62e6-4f7d-bafa-fe4ce5cb4f54\",\"title\":\"Replymyplan1ea6c601-7\",\"type\":\"/new-plan\"}```"}, {"creator_id": "U06M70HTC7Q", "text": "```{\"parentBlockId\":\"1ea6c601-7621-4716-92d2-4bd4f4b1d49a\",\"parentThreadId\":\"b110eabb-62e6-4f7d-bafa-fe4ce5cb4f54\",\"title\":\"Replymyplan1ea6c601-7\",\"type\":\"/new-plan\"}```"}, {"creator_id": "USLACKBOT", "text": ""}, {"creator_id": "U06M70HTC7Q", "text": "Sure"}, {"creator_id": "U066Q9JAU3B", "text": "huddle?"}, {"creator_id": "U06M70HTC7Q", "text": "Found one bug. I created a new block and in this, I am getting creator picture value inside creator_email. Below is the response.\n```{ _id: 9a817cdb-fb3f-4ba5-9823-4f219d7b1346, \n child_id: , \n content: Checking if creating this new block will change \"Id\" to \"_id\" or not., \n created_at: 2024-03-20T06:19:13.496987, created_by: Sonu Sharma, \n creator_email: <https://lh3.googleusercontent.com/a/ACg8ocKHPIrrxY0nLtFOOHM8j2LnbYDqUw8Fffswny9oNWpcADA=s96-c>, creator_id: 471c9bf1-7da8-4678-b6ee-eca13fb6fa5a, creator_picture: unknown picture link\n}```"}, {"creator_id": "U066Q9JAU3B", "text": "just fixed this bug and pushed changes"}, {"creator_id": "U066Q9JAU3B", "text": "pushed the fixes:\n1. Newly created blocks have the key \"_id\" instead of \"id\". We still have to fix all the old blocks in the db. For now, you can create new blocks and work with them.\n2. Pushed new API to get the thread with just the thread_id as input. See example \n```await threadApi.getThreadIdThreadsIdGet(\n        id: \"2bcad996-8391-4ddf-a274-bf84d6904906\");```"}, {"creator_id": "U066Q9JAU3B", "text": "```flutter: {\"parentBlockId\":\"a73a294e-367a-437d-b71e-e53f7058b49f\",\"parentThreadId\":\"b110eabb-62e6-4f7d-bafa-fe4ce5cb4f54\",\"title\":\"myownchildthread\",\"type\":\"/new-plan\"}\nflutter: \nflutter: *** Response ***\nflutter: uri: <http://0.0.0.0:8000/blocks/child>\nflutter: Response Text:\nflutter: {\"_id\":\"ed499955-2fde-47dc-a935-e27dd8a916d6\",\"creator\":\"Yogesh K. Soni\",\"created_date\":\"2024-03-19T10:06:12.203116\",\"type\":\"/new-plan\",\"title\":\"myownchildthread\",\"content\":[{\"_id\":\"a8f81b1b-c2f3-4e1a-bed3-8fa043b9915e\",\"content\":\"let's see if the new thread works as expected\\n\",\"created_at\":\"2024-02-03T09:25:51.549000\",\"created_by\":\"unknown user\",\"creator_email\":\"unknown email\",\"creator_picture\":\"unknown picture link\",\"creator_id\":\"unknown id\",\"child_id\":\"\"}]}\nflutter: ```"}, {"creator_id": "U06M70HTC7Q", "text": "<@U066Q9JAU3B> I have created new blocks and trying to create child thread but every time I am getting same old Internal server error response. Below is the request and response data.\n\n```flutter: *** Request ***\nflutter: uri: <http://35.209.147.65:8000/blocks/child>\nflutter: method: POST\nflutter: responseType: ResponseType.json\nflutter: followRedirects: true\nflutter: persistentConnection: true\nflutter: connectTimeout: null\nflutter: sendTimeout: null\nflutter: receiveTimeout: null\nflutter: receiveDataWhenStatusError: true\nflutter: extra: {secure: []}\nflutter: data:\nflutter: {\"parentBlockId\":\"1ea6c601-7621-4716-92d2-4bd4f4b1d49a\",\"parentThreadId\":\"b110eabb-62e6-4f7d-bafa-fe4ce5cb4f54\",\"title\":\"testReplyfeature\",\"type\":\"/new-plan\"}\nflutter: \nflutter: Server error: This exception was thrown because the response has a status code of 500 and RequestOptions.validateStatus was configured to throw for this status code.\nThe status code of 500 has the following meaning: \"Server error - the server failed to fulfil an apparently valid request\"\nRead more about status codes at <https://developer.mozilla.org/en-US/docs/Web/HTTP/Status>\nIn order to resolve this exception you typically have either to verify and fix your request code or you have to fix the server code.\n\nflutter: *** DioException ***:\nflutter: uri: <http://35.209.147.65:8000/blocks/child>\nflutter: DioException [bad response]: This exception was thrown because the response has a status code of 500 and RequestOptions.validateStatus was configured to throw for this status code.\nThe status code of 500 has the following meaning: \"Server error - the server failed to fulfil an apparently valid request\"\nRead more about status codes at <https://developer.mozilla.org/en-US/docs/Web/HTTP/Status>\nIn order to resolve this exception you typically have either to verify and fix your request code or you have to fix the server code.\n\nflutter: uri: <http://35.209.147.65:8000/blocks/child>\nflutter: Response Text:\nflutter: Internal Server Error```"}, {"creator_id": "U06M70HTC7Q", "text": "Let's sit together whenever you are available to resolve those issue. Meanwhile, I am starting to implement fetch replies api."}, {"creator_id": "U066Q9JAU3B", "text": "yeah, I am ready to huddle when you are"}, {"creator_id": "U066Q9JAU3B", "text": "```BlockModel({\n\n     this.id,\n\n     this.childId = '',```"}, {"creator_id": "USLACKBOT", "text": ""}, {"creator_id": "U066Q9JAU3B", "text": "We may just want to use a package like I sent earlier if firebase sdk does not support it. <https://trymonk.slack.com/archives/D06N2D1STU0/p1710823899671289?thread_ts=1710813071.206529&amp;cid=D06N2D1STU0>"}, {"creator_id": "U066Q9JAU3B", "text": "the openId connect for IOS is implemented in Swift. I don't think we want that."}, {"creator_id": "U06M70HTC7Q", "text": "And may it can help as well =&gt; <https://firebase.flutter.dev/docs/auth/custom-auth>"}, {"creator_id": "U06M70HTC7Q", "text": "After slack login we receive a token and I think that token can be used here."}, {"creator_id": "U066Q9JAU3B", "text": "yeah, but how are we going to log in?"}, {"creator_id": "U06M70HTC7Q", "text": "It has doc for openId connect doc for iOS -&gt; <https://firebase.google.com/docs/auth/ios/openid-connect>"}, {"creator_id": "U066Q9JAU3B", "text": "in the flutter social auth section, openid is not listed. So I am not sure if it is supported. <https://firebase.google.com/docs/auth/flutter/federated-auth>"}, {"creator_id": "U066Q9JAU3B", "text": "The only doubt I have is that their documentation mentions open id auth in 'web apps' section - <https://firebase.google.com/docs/auth/web/openid-connect>"}, {"creator_id": "U066Q9JAU3B", "text": "I haven't tried but it should work."}, {"creator_id": "U066Q9JAU3B", "text": "they have openid connect support (paid feature but I will pay)."}, {"creator_id": "U06M70HTC7Q", "text": "Is it easier than Supertoken to implement? and will it woks with Slack auth ?"}, {"creator_id": "U066Q9JAU3B", "text": "Ok. I did a small firebase PoC. I think we should be OK to migrate to firebase.\nI am also looking at firebase hosting and google cloud run. Already thinking about multi-tenancy"}, {"creator_id": "USLACKBOT", "text": ""}, {"creator_id": "U06M70HTC7Q", "text": "Yes"}, {"creator_id": "U066Q9JAU3B", "text": "I have one question about auth flow. do you have a few minutes for huddle?"}, {"creator_id": "U066Q9JAU3B", "text": "BTW, for implementing the frontend for slack sign in flow, we may need to use this package. Found it somewhere in supertokens docs. This is akin to google_sign_in package.\n<https://pub.dev/packages/flutter_appauth>"}, {"creator_id": "U066Q9JAU3B", "text": "quite a detailed step by step tutorial here:\n<https://wso2.com/asgardeo/docs/tutorials/auth-users-into-flutter-apps/#step-6-implement-login>"}, {"creator_id": "U066Q9JAU3B", "text": "I am seriously considering Firebase. Will try a simple PoC with FastAPI and Firebase.\nThen we could run our backend with FireBase auth and Google Cloud run. We anyways need cloud. Right now I have code running on VM. Not sure it will pass any kind of security certification :slightly_smiling_face:"}, {"creator_id": "U066Q9JAU3B", "text": "I have tested the new API to create the child thread of a block.\n\u2022 You will need to provide the id of parent block, and id of parent thread while creating the child thread. \n\u2022 child_id field of Parent block is automatically updated with the child thread's id.\n\u2022 Also child thread automatically gets populated with the one block (parent block's content).\n\u2022 In UI, when user clicks 'reply in thread', then this api to create child should be called. It returns the child thread with it's content, which you can render.\n\u2022 The parent block must now show 'replies'. Clicking on replies should simply navigate to the child thread (you already have child_id, which can be used to fetch the thread)\nHere is the sample code for the API call\n```    CreateChildThreadModel createChildThreadModel = CreateChildThreadModel(\n      title: \"myownchildthread\",\n      type: \"/new-plan\",\n      parentBlockId: \"b342a310-cd4e-444e-8f0f-8e511d908b7f\",\n      parentThreadId: \"713059f7-b4ca-49ed-a35c-d28e6569da81\",\n    );\n    await threadApi.childThreadBlocksChildPost(\n        createChildThreadModel: createChildThreadModel);```"}, {"creator_id": "U06M70HTC7Q", "text": "OK, I'll check this API today"}, {"creator_id": "U06M70HTC7Q", "text": "<@U066Q9JAU3B> with this same `createChildThreadModel` object I am getting null response values and when I am sending other values then I am getting status code 500."}, {"creator_id": "U06M70HTC7Q", "text": "one more thing in `BlockModel` the json key if `id` is not defied as `_id`. So due to this I am not able to access the id. I have checked the API response and it is coming as `_id`."}, {"creator_id": "U066Q9JAU3B", "text": "Re: the null response. If you tried exactly the parameters that I shared (same parent block and thread ids), you will get null. The backend sends null and prints this message (\"block already has a child thread\")"}, {"creator_id": "U066Q9JAU3B", "text": "This is to prevent to create many spurious orphaned child threads.."}, {"creator_id": "U066Q9JAU3B", "text": "I just manually deleted the child thread in the database and the api worked as expected."}, {"creator_id": "U066Q9JAU3B", "text": "Now if you try it should work (because I just deleted the child again)."}, {"creator_id": "U066Q9JAU3B", "text": "I did not understand the second issue: I checked that ThreadModel is similar in definition:\n```  ThreadModel({\n\n     this.id,\n\n     this.content,\n\n     this.createdDate,\n\n    required  this.creator,\n\n    required  this.title,\n\n    required  this.type,\n  });\n\n  @JsonKey(\n    \n    name: r'_id',\n    required: false,\n    includeIfNull: false\n  )```"}, {"creator_id": "U066Q9JAU3B", "text": "Here is the api response when new thread is created\n``````"}, {"creator_id": "U066Q9JAU3B", "text": "we can huddle to solve the second issue."}, {"creator_id": "U066Q9JAU3B", "text": "let me know when you are available"}, {"creator_id": "U066Q9JAU3B", "text": "I accidentally deleted journal thread from db! was using it to test the creation of child.\nNow if you want to test, use different parent block and thread ids.\n``` CreateChildThreadModel createChildThreadModel = CreateChildThreadModel(\n      title: \"myownchildthread\",\n      type: \"/new-plan\",\n      parentBlockId: \"a73a294e-367a-437d-b71e-e53f7058b49f\",\n      parentThreadId: \"b110eabb-62e6-4f7d-bafa-fe4ce5cb4f54\",\n    );\n    await threadApi.childThreadBlocksChildPost(\n        createChildThreadModel: createChildThreadModel);\n  }```"}, {"creator_id": "U06M70HTC7Q", "text": "Huddle ?"}, {"creator_id": "U06M70HTC7Q", "text": "Below is the json response of threads.\n\n```{\n  \"_id\": \"2bcad996-8391-4ddf-a274-bf84d6904906\",\n  \"creator\": \"Yogesh K. Soni\",\n  \"created_date\": \"2024-03-08T00:58:50.166015\",\n  \"type\": \"/new-project\",\n  \"title\": \"UXDesignForMonk\",\n  \"content\": [\n    {\n      \"id\": \"02900864-0f42-4ae9-a721-aceac9450f4b\",\n      \"content\": \"First draft has been made on Figma. Now we are discussing it.\",\n      \"created_at\": \"2024-03-08T00:59:09.497000\",\n      \"created_by\": \"Yogesh K. Soni\"\n    }\n  ]\n}```"}, {"creator_id": "U06M70HTC7Q", "text": "You see there is `id` in content instead of `_id` and this is the reason I am getting null id in Block model"}, {"creator_id": "U06M70HTC7Q", "text": "<@U066Q9JAU3B>"}, {"creator_id": "U066Q9JAU3B", "text": "huddle?"}, {"creator_id": "U06M70HTC7Q", "text": "Get channel list: <https://slack.com/api/conversations.list>\nGet channel history: <https://slack.com/api/conversations.history?channel=C068YPZA8KV&amp;subtype=message>"}, {"creator_id": "U06M70HTC7Q", "text": "<https://slack.com/api/openid.connect.token>? code=4287010774055.6831061836145.1557b4c114370a8e46ba4dbfc08573216cdd88345a7814c21d7360ea0e64b94c&amp;redirect_uri=<https://cfba-2405-201-6817-6087-44f3-12e4-2315-bd2f.ngrok-free.app/api/auth/calllback/slack&amp;grant_type=authorization_code&amp;client_id=4287010774055.6810855127681&amp;client_secret=34d290bec1981741d0f332d55e81c875>"}, {"creator_id": "U06M70HTC7Q", "text": ""}, {"creator_id": "USLACKBOT", "text": ""}, {"creator_id": "U06M70HTC7Q", "text": "<https://hoppscotch.io/>"}, {"creator_id": "U066Q9JAU3B", "text": "yeah I can huddle"}, {"creator_id": "U06M70HTC7Q", "text": "I think I found a way to get data from slack after authentication."}, {"creator_id": "U06M70HTC7Q", "text": "I formed an OAuth UrL to redirect user to slack login.\nOauth URL -> <https://trymonk.slack.com/oauth?client_id=4287010774055.6810855127681&scope=channels%3Ahistory%2Cgroups%3Ahistory%2Cmpim%3Ahistory%2Cim%3Ahistory%2Cchannels%3Aread%2Cgroups%3Aread%2Cim%3Aread&user_scope=channels%3Ahistory%2Cgroups%3Ahistory%2Cmpim%3Ahistory%2Cim%3Ahistory%2Cchannels%3Aread%2Cgroups%3Aread%2Cim%3Aread&redirect_uri=https%3A%2F%2Fcfba-2405-201-6817-6087-44f3-12e4-2315-bd2f.ngrok-free.app%2Fapi%2Fauth%2Fcalllback%2Fslack&state=&granular_bot_scope=1&single_channel=0&install_redirect=&tracked=1&team=1|https://trymonk.slack.com/oauth?client_id=4287010774055.6810855127681&scope=channels%[\u2026]_scope=1&single_channel=0&install_redirect=&tracked=1&team=1>"}, {"creator_id": "U06M70HTC7Q", "text": "Steps to form this url given here-&gt; <https://slack.com/oauth/v2/authorize>?"}, {"creator_id": "U06M70HTC7Q", "text": "once the user successfully login, it redirects the user to give `redirect_url` in Oauth URL ^ with a temporary code."}, {"creator_id": "U06M70HTC7Q", "text": "Using this code we can get access token using `<https://slack.com/api/openid.connect.token>` api."}, {"creator_id": "U06M70HTC7Q", "text": "Once we have `access_token` we can get the list of channels and conversations."}, {"creator_id": "U06M70HTC7Q", "text": "Available for quick huddle ?"}, {"creator_id": "U06M70HTC7Q", "text": "Hi <@U066Q9JAU3B>"}, {"creator_id": "U066Q9JAU3B", "text": "```&lt;a href=\"<https://slack.com/oauth/v2/authorize?scope=incoming-webhook&amp;client_id=33336676.569200954261>\"&gt;Add to Slack&lt;/a&gt;```"}, {"creator_id": "USLACKBOT", "text": ""}, {"creator_id": "U06M70HTC7Q", "text": "<https://api.slack.com/authentication/sign-in-with-slack#request>"}, {"creator_id": "U06M70HTC7Q", "text": "<https://api.slack.com/authentication/oauth-v2>"}, {"creator_id": "U066Q9JAU3B", "text": "I am mulling over \"Sign In with Slack\" for Monk"}, {"creator_id": "U066Q9JAU3B", "text": "see #SignInWithSlack thread on Monk"}, {"creator_id": "U066Q9JAU3B", "text": "Damn. I wanted to create a new thread. Seems / commands are no longer working."}, {"creator_id": "U066Q9JAU3B", "text": "I got following error when try to enter the first message inside the new thread.\n``````"}, {"creator_id": "U066Q9JAU3B", "text": "This is what I was trying to do"}, {"creator_id": "U066Q9JAU3B", "text": "Ok. I see that shortcut for entering new block is Meta+Enter instead of SHIFT+ENTER. We should change the text hint accordingly."}, {"creator_id": "U066Q9JAU3B", "text": "i think this is the problem."}, {"creator_id": "U06M70HTC7Q", "text": "This is probably happening due to design responsiveness. We have to make design responsive in inorder to fix this type of issues."}, {"creator_id": "U066Q9JAU3B", "text": "Could you please explain? I am not sure what that means."}, {"creator_id": "U06M70HTC7Q", "text": "By the term `responsiveness` I am referring to different sizes of app width (Mobile | Tablet | Desktop)."}, {"creator_id": "U06M70HTC7Q", "text": "This yellow bar displays only in development mode when some content of app doesn't fit horizontally or vertically."}, {"creator_id": "U066Q9JAU3B", "text": "Hoping we can fix it? This is the first page in a demo, terrible first impression if we don't fix."}, {"creator_id": "U06M70HTC7Q", "text": "Yes, I'll fix this today"}, {"creator_id": "U066Q9JAU3B", "text": "Here is what I am thinking re; Slack integration\n1. User signs in with Slack - <https://api.slack.com/authentication/sign-in-with-slack>\n2. We implement a second oauth flow to ask for additional scopes for the user - <https://api.slack.com/authentication/oauth-v2>\n3. We show user's public channels in the frontend UI and ask them to select the channels they want to import to Monk - <https://api.slack.com/methods/conversations.list>\n4. After the import is finished, we show the channel's threads in the newfeed. - <https://api.slack.com/methods/conversations.history>\n5. Optionally we could invite Monk app to all the public channels that user is a part of. But for that,  someone will have to install Monk bot - <https://api.slack.com/methods/conversations.invite>\n"}, {"creator_id": "U066Q9JAU3B", "text": "Do you see any gotchas in this plan?"}, {"creator_id": "U06M70HTC7Q", "text": "This approach seems good to me. However, I have a question regarding who will be able to import the Slack channel from Monk after logging in with Slack. Can any user do this, or is it limited to a particular role such as an admin?"}, {"creator_id": "U066Q9JAU3B", "text": "THAT is a million dollar question. Only way to test this is to try it. Documentation is unclear.\nIn order to read messages from all public channels a user is a part of, they need the following scopes:\n\n`channels:history`\n`groups:history`\n`im:history`\n`mpim:history`\n\nIf (BIG IF) we are able to implement the oauth flow where user requests these scopes, and is granted a corresponding token, then we can use that token to read the channel messages."}, {"creator_id": "U06M70HTC7Q", "text": "After login with Slack, on which screen we will show Slack public channel to user for import?"}, {"creator_id": "U066Q9JAU3B", "text": "the screen after loggin in, we will ask the user if they would like to import their public slack channels to Monk. If they say yes, we will request additional scope using oauth."}, {"creator_id": "U066Q9JAU3B", "text": "quick huddle?"}, {"creator_id": "U06M70HTC7Q", "text": "Sure"}, {"creator_id": "U066Q9JAU3B", "text": "Since we have been chatting quite often, on Slack. We have been discussing on many topics. It is a pain to go back and look for some conversation on slack.\n\nI tried slack's search \"thread where we are talking about code to fetch threads messages programmatically\". It yielded zero results!!\n\nMonk's semantic search is already lot better than this. Let me try to import our DMs to Monk as well. I will show you exactly this search query.\n\nMonk is different because we have topic centric discussion, not user centric."}, {"creator_id": "U066Q9JAU3B", "text": "Also, we should totally steal Slack's design, where hovering over a block shows modal with actions, including reply button."}, {"creator_id": "U06M70HTC7Q", "text": "This looks promising design to show block-related options. I'll look for a way to implement this"}, {"creator_id": "U066Q9JAU3B", "text": "ok"}, {"creator_id": "U06M70HTC7Q", "text": "Below points are done and pushed to develop branch.\n\u2022 Add thread detail page showing list of main thread and list of replies.\n\u2022 Added thread detail provider to handle thread detail state and simulate api call."}, {"creator_id": "U06M70HTC7Q", "text": "Here is the sample JSON structure that needed in replies API response.\n```{\n  \"thread\":{\n      \"id\": \"SOME-ID\",\n      \"content\": \"\",\n      \"created_at\": \"\",\n      \"created_by\": \"\",\n      \"creator_email\": \"\",\n      \"creator_picture\": \"\",\n      \"replyCount\":2\n    },\n  \"replies\": [\n    {\n      \"parentId:\"SOME-ID\",\n      \"id\": \"7eeab029-fa46-4a13-aa10-ed7f60875230\",\n      \"content\": \"A company with sizable number of employees (&gt; 500) will tend to grow in all directions (personal agendas, divergent ideas, lack of clarity, lack of alignment etc.)\\n\",\n      \"created_at\": \"2024-03-11T00:23:53.147000\",\n      \"created_by\": \"Yogesh K. Soni\",\n      \"creator_email\": \"<mailto:yksoni@gmail.com|yksoni@gmail.com>\",\n      \"creator_picture\": \"<https://lh3.googleusercontent.com/a/ACg8ocINw3k9RplX-1xQQbxdmKav0dxSRaJ8xsMyI-HWvtpFXlkn=s96-c>\"\n    },\n    {\n      \"parentId:\"SOME-ID\",\n      \"id\": \"33fda9b0-3170-47c6-b593-c8d14b295313\",\n      \"content\": \"A company can be thought of as a town with an economy that needs to be sustained.\\nor it can be thought of as a pirate ship, that needs to look for next oppurtunity to loot.\",\n      \"created_at\": \"2024-03-11T00:25:15.803000\",\n      \"created_by\": \"Yogesh K. Soni\",\n      \"creator_email\": \"<mailto:yksoni@gmail.com|yksoni@gmail.com>\",\n      \"creator_picture\": \"<https://lh3.googleusercontent.com/a/ACg8ocINw3k9RplX-1xQQbxdmKav0dxSRaJ8xsMyI-HWvtpFXlkn=s96-c>\"\n    }\n    \n  ]\n}```"}, {"creator_id": "U066Q9JAU3B", "text": "I think you mean \"Block\" here and not \"thread\" in the top-level json.\n\nFeed = Collection of Threads\nThread = Collection of Blocks\nBlocks = (Sometimes), collection of replies, where reply is also a block.\n\nIf the taxonomy is starting to get complicated, we will need to simplify it. Block is simply a message. May be that is a better term. Block seems technical. Thread is a conversation. Feed is a list of conversation."}, {"creator_id": "U066Q9JAU3B", "text": "I have a suggestion which will make the design simpler.\nIf we are gonna show replies in a new page anyways, might as well create a new thread. Don't you think it is simpler then?\n\nWhat this mean is that, we will not have to implement the concept of replies in the database and in our api.\n\nThink about this, we are essentially forking a new conversation.\n\nReplies is simply a pointer to a new child thread that contains blocks.\n\nSo when a user presses 'reply' button, frontend should call create new thread api with {\"type\":\"child\", title;\"blockid_of_parent_block\"}.\n\nIf a block has replies, then the frontend should show '<n> replies' instead\n\nLet's discuss this further before implementing more code."}, {"creator_id": "U066Q9JAU3B", "text": "Re: sometimes id of block being null, I saw indeed corrupt blocks in the database. They were leftovers from initial days.\nThey look like following and I have deleted them:"}, {"creator_id": "U06M70HTC7Q", "text": "Agreed with the new thread concept."}, {"creator_id": "U066Q9JAU3B", "text": "ok. Try implementing this flow, where when user presses 'reply' button, a new thread is created, with the parent blocks as the first block"}, {"creator_id": "U06M70HTC7Q", "text": "Just checked `null` is not getting for all threads Id. There are some threads existswhich have this null value."}, {"creator_id": "U06M70HTC7Q", "text": "Hi, I am getting Id as `null` in all thread blocks. Apart from this fix, can you add reply count ? it is required to be displayed on the thread card."}, {"creator_id": "USLACKBOT", "text": ""}, {"creator_id": "U06M70HTC7Q", "text": "Sure"}, {"creator_id": "U066Q9JAU3B", "text": "yes, reply box will always be visible. I assume by reply box, you mean the replies, that are blocks of texts .\nI didn't quite understand the second question. Quick huddle?"}, {"creator_id": "U06M70HTC7Q", "text": "Regarding the replies, the reply box will always be visible for each thread right ? I am assuming thread reply content format will be the same as tread."}, {"creator_id": "U066Q9JAU3B", "text": "ok. Sounds like a plan. While I work on the backend API, you could make 2 changes in rendering the thread\n1. Block with replies (from Figma Design pages 8/9)\n2. Web link metadata (this solves a lot of usecases)."}, {"creator_id": "U06M70HTC7Q", "text": "I think we should integrate Slack gradually, starting with fetching a list of channels with other threads list. Then, we can display the Slack channel messages in a plain text format, followed by the possibility of showing content in a rich text format later on."}, {"creator_id": "U066Q9JAU3B", "text": "Re; your question about how are Slack messages different, I see a few things:\n1. Slack threads don't have titles and types. We can either generate them automatically, or use channel name as title for now and 'slack' for type.\n2. Messages inside channels can have replies (threads). So the back end will give content in the following format:\n       [ block, block, block_with_replies, block, block]\n       So, we need to implement the block_with_replies in the frontend as well.\n 3. Slack messages can have emojis, code blocks, mentions etc. Since we don't support these, we need to think how do we plan to render the content of these types.\n\nAnything else I am missing?"}, {"creator_id": "U066Q9JAU3B", "text": "Yes. As far as accessing threads from slack, we should stick to the same method for accessing them."}, {"creator_id": "U06M70HTC7Q", "text": "Right now we are accessing threads using `/go` command. Is this the same way to access slack channel ?"}, {"creator_id": "U06M70HTC7Q", "text": "Alternatively below is the sample api response needed for slack channel.\n```{\n  \"creator\": {\n    \"name\": \"NAME\",\n    \"picture\": \"PICTURE\",\n    \"id\": \"ID\"\n  },\n  \"createdAt\": \"TIME\",\n  \"type\": \"message\",\n  \"ts\": \"1702168021.581239\",\n  \"client_msg_id\": \"1e841c8e-0bb0-4182-807d-6978d796d611\",\n  \"text\": \"open source model to try - mistral &lt;<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>&gt;\",\n  \"attachments\": [\n    {\n      \"from_url\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\",\n      \"image_url\": \"<https://og.replicate.com/api/models/nateraw/mixtral-8x7b-32kseqlen>\",\n      \"image_width\": 1200,\n      \"image_height\": 630,\n      \"image_bytes\": 304690,\n      \"service_icon\": \"<https://replicate.com/static/apple-touch-icon.1adc51db122a.png>\",\n      \"id\": 1,\n      \"original_url\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\",\n      \"fallback\": \"nateraw/mixtral-8x7b-32kseqlen \u2013 Replicate\",\n      \"text\": \"MistralAI's new 8x7B Mixture of Experts (MoE) base model for text generation\",\n      \"title\": \"nateraw/mixtral-8x7b-32kseqlen \u2013 Replicate\",\n      \"title_link\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\",\n      \"service_name\": \"<http://replicate.com|replicate.com>\"\n    }\n  ]\n}```"}, {"creator_id": "U06M70HTC7Q", "text": "How slack channel ui will be different from thread UI ? Is it possible to shape slack API response same as threads response ?"}, {"creator_id": "U066Q9JAU3B", "text": "Sure. That makes sense. I suggest that you build out the frontend UI based on the data from \"ai_learning\" channel and a dummy API call. Then tell me exactly what API you need from the backend. Works?"}, {"creator_id": "U06M70HTC7Q", "text": "If we are going to digest slack API on frontend side then it will be lot of API calling every time for all users. I suggest we should consume slack apis on backend and should store slack API response in database."}, {"creator_id": "U066Q9JAU3B", "text": "Ok. So are you working on the slack integration end to end?"}, {"creator_id": "U06M70HTC7Q", "text": "Below points are done and changes pushed to develop branch.\n\u2022 Updated home page design\n\u2022 Added app color scheme.\n\u2022 Update app theme"}, {"creator_id": "U066Q9JAU3B", "text": "Looks amazing :raised_hands:"}, {"creator_id": "U06M70HTC7Q", "text": "This is the slack api that I am using -&gt; <https://api.slack.com/messaging/retrieving>"}, {"creator_id": "U06M70HTC7Q", "text": "One more thing this api also returns every event data. for example messages, user joined/left channel etc. I think we need to find a way to filter only message type data.\nHere is the sample date of user joined event.\n```{\n            \"subtype\": \"channel_join\",\n            \"user\": \"U06P1K7DANB\",\n            \"text\": \"<@U06P1K7DANB> has joined the channel\",\n            \"inviter\": \"U06M70HTC7Q\",\n            \"type\": \"message\",\n            \"ts\": \"1710393806.729219\"\n},```"}, {"creator_id": "U066Q9JAU3B", "text": "this api returns only messages in a conversation (aka channel).. <https://api.slack.com/methods/conversations.replies>"}, {"creator_id": "U066Q9JAU3B", "text": "Additionally, you could spot threads within a conversation and retrieve replies within a thread using the following method.\n<https://api.slack.com/messaging/retrieving#finding_threads>"}, {"creator_id": "U066Q9JAU3B", "text": "here is a piece of python code to list channels\n```import os\nfrom slack_sdk import WebClient\n\n# Get the bot token from the environment variable\nSLACK_BOT_TOKEN = os.environ.get(\"SLACK_BOT_TOKEN\")\n\n# Create a Slack client instance\nclient = WebClient(token=SLACK_BOT_TOKEN)\n\nresponse = client.conversations_list()\n\nif response[\"ok\"]:\n    # Iterate through channels and print name and ID\n    for channel in response[\"channels\"]:\n        print(f\"Channel Name: {channel['name']}, ID: {channel['id']}\")\nelse:\n    print(f\"Error: {response['error']}\")```"}, {"creator_id": "U06M70HTC7Q", "text": "Tried to get the channel history using slack API. I am getting channel content but  I am getting userId and channel Id instead of names. I believe it is required to display who created the messages.\n```{\n            \"user\": \"U066Q9JAU3B\",\n            \"type\": \"message\",\n            \"ts\": \"1702168021.581239\",\n            \"client_msg_id\": \"1e841c8e-0bb0-4182-807d-6978d796d611\",\n            \"text\": \"open source model to try - mistral &lt;<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>&gt;\",\n            \"team\": \"T048F0ANS1M\",\n            \"attachments\": [\n                {\n                    \"from_url\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\",\n                    \"image_url\": \"<https://og.replicate.com/api/models/nateraw/mixtral-8x7b-32kseqlen>\",\n                    \"image_width\": 1200,\n                    \"image_height\": 630,\n                    \"image_bytes\": 304690,\n                    \"service_icon\": \"<https://replicate.com/static/apple-touch-icon.1adc51db122a.png>\",\n                    \"id\": 1,\n                    \"original_url\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\",\n                    \"fallback\": \"nateraw/mixtral-8x7b-32kseqlen \u2013 Replicate\",\n                    \"text\": \"MistralAI's new 8x7B Mixture of Experts (MoE) base model for text generation\",\n                    \"title\": \"nateraw/mixtral-8x7b-32kseqlen \u2013 Replicate\",\n                    \"title_link\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\",\n                    \"service_name\": \"<http://replicate.com|replicate.com>\"\n                }\n            ],\n            \"blocks\": [\n                {\n                    \"type\": \"rich_text\",\n                    \"block_id\": \"cTxkO\",\n                    \"elements\": [\n                        {\n                            \"type\": \"rich_text_section\",\n                            \"elements\": [\n                                {\n                                    \"type\": \"text\",\n                                    \"text\": \"open source model to try - mistral \"\n                                },\n                                {\n                                    \"type\": \"link\",\n                                    \"url\": \"<https://replicate.com/nateraw/mixtral-8x7b-32kseqlen>\"\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        },```"}, {"creator_id": "U066Q9JAU3B", "text": "Ok, I will check how to get the user name and channel names.. How did you authenticate to retrieve this information from Slack API? Was being a member of public channel enough, even though you are not a slack admin? Is User token enough?"}, {"creator_id": "U066Q9JAU3B", "text": "I see you added Monk Service app. What kind of authorization do you need for this?"}, {"creator_id": "U066Q9JAU3B", "text": "By using another api, you could get a list of user profile info and store it.. then you could look up user's name using their Id.\n<https://api.slack.com/methods/users.list/code>"}, {"creator_id": "U066Q9JAU3B", "text": "similarly, you could list channels, and then figure out the channel names from a given ID.\n<https://api.slack.com/methods/admin.usergroups.listChannels>"}, {"creator_id": "U066Q9JAU3B", "text": "One last thing: It seems an app has to be invited to a public channel manually (or programmatically by a user who is already member of the channel). Bot cannot read messages otherwise."}, {"creator_id": "U06M70HTC7Q", "text": "That is correct. I manually added the bot to the channel and then created an app-level token for it from the Slack app dashboard. This token serves as the authentication bearer token in the API for retrieving channel history."}, {"creator_id": "U066Q9JAU3B", "text": "it will be impressive to show the content as is from ai_learning channel."}, {"creator_id": "U06M70HTC7Q", "text": "Ok, I'll look into these today."}, {"creator_id": "U066Q9JAU3B", "text": "BTW, I didn't get a chance to implement the Slack API today. I had to go out for business meetings.\n\u2022 I guess you could implement the flow in the frontend with dummy api's (that return the data copied manually from a couple of channels from this Slack workspace). I will get to it tomorrow.\n\u2022 Also, there is still 'reply' feature to implement (page 8, 9 of the Figma design <https://www.figma.com/proto/SIqCWiJxBVxMXZCOTlIUBT/Monk?type=design&amp;node-id=47-2204&amp;t=CSBWtn0BhWNZkaSk-0&amp;scaling=scale-down&amp;page-id=33%3A91>)\n\u2022 We could also move to color theme of the UI\n\u2022 Lastly, there is Monk Logo in the Figma design which we can start using.\n"}, {"creator_id": "U066Q9JAU3B", "text": ":+1:"}, {"creator_id": "U06M70HTC7Q", "text": "The issue is fixed and pushed to develop branch."}, {"creator_id": "U066Q9JAU3B", "text": "Merged and pushed.\nBTW, I get red screen exception when I click on one of the cards."}, {"creator_id": "U066Q9JAU3B", "text": ":+1:"}, {"creator_id": "U06M70HTC7Q", "text": "Changes pushed to develop branch"}, {"creator_id": "U06M70HTC7Q", "text": "Ok"}, {"creator_id": "U066Q9JAU3B", "text": "good for now. We may have to play with the sizes a little bit once you have the support of showing images from website links.. Please go ahead and push these changes.. I will merge now."}, {"creator_id": "U06M70HTC7Q", "text": ""}, {"creator_id": "U06M70HTC7Q", "text": "Yes, let me do that"}, {"creator_id": "U066Q9JAU3B", "text": "yeah, only a little. I think we should also decrease the width of the command box. It is looking a bit awkward, isn't it? What do you think?"}, {"creator_id": "U06M70HTC7Q", "text": "Should I increase card height little more ?"}, {"creator_id": "U06M70HTC7Q", "text": ""}, {"creator_id": "U066Q9JAU3B", "text": "something like this."}, {"creator_id": "U066Q9JAU3B", "text": "And then if you increase the heigth of the card too, then you will probably see 2-3 cards on the screen (which is better than 6 cards)"}, {"creator_id": "U066Q9JAU3B", "text": "No, I just mean the width of each card should be half size, so there is more real estate on left and right.. you see Google's home page right? There are a lot of blank space. brings a sense of calm."}, {"creator_id": "U06M70HTC7Q", "text": "Do you mean one card in 1 row ?"}, {"creator_id": "U066Q9JAU3B", "text": "is it possible to make the cards square, by reducing the card width by half?"}, {"creator_id": "U06M70HTC7Q", "text": "Done"}]}